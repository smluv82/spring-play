## CoroutineDispatcher

1. 역할
    1. Dispatch (보내다) er (붙여서 보내는 주체가 됨). 스레드에게 코루틴을 보내는 주체라는 말.
    2. 코루틴을 실행 요청한 스레드에서 코루틴이 실행되도록 만듬.
    3. 코루틴의 실행을 관리하는 주체로 자신에게 실행 요청된 코루틴들을 작업 대기열에 적재하고, 자신이 사용 할 수 있는 스레드가 새로운 작업을 실행 할 수 있는 상태라면 스레드로 코루틴을 보내 실행
    4. 코루틴의 실행 옵션에 따라 작업 대기열에 보내지 않고, 즉시 실행 할 수도 있음. 대기열 있는건 제한된 디스패처, 없는건 무제한 디스패처라고 한다.

2. 제한된 디스패처 생성 방법
    1. 단일 스레드 디스패처는 다음과 같이 생성 할 수 있다.
       ```
       val dispatcher: CoroutineDispatcher = newSingleThreadContext(name = "SingleThread")
       ```
    2. 멀티 스레드 디스패처
       ```
       val multiThreadDispatcher: CoroutineDispatcher = newFixedThreadPoolContext(
         nThreads = 2,
         name = "MultiThread"
       )
       ```
    3. 디스패처에서 스레드 생성하는 로직을 보면 모두 데몬스레드로 생성함 (데몬스레드란 작업이 끝나지 않았어도 어플리케이션은 종료될 수 있는 스레드, 우선순위 스레드가 아님.)
    4. CoroutineDispatcher는 추상 클래스여서 다양하게 구현 가능함.
    5. newFixedThreadPoolContext() 함수로 코루틴 디스패처를 생성하면 코루틴 전용 스레드풀이 생성되므로 실무에서 사용을 권하지 않는다. 스레드 풀 생성비용은 비싸다는걸 잊지말자.
    6. 코루틴 라이브러리는 개발자가 직접 코루틴 디스패처 객체를 생성하는 문제의 방지를 위해 미리 정의된 Coroutine

3. 미리 정의된 CoroutineDispatcher
    1. Dispatchers.IO (싱글톤) : 네트워크 요청, 파일 입출력, RDB 등의 입출력(IO) 작업을 위한 코루틴 디스패처
        1. 최대로 사용 가능한 스레드 수는 JVM에서 사용 가능한 프로세서 수와 64 중 큰 값으로 설정
        2. 코루틴 라이브러리에서 제공하는 공유 스레드 풀에 속한 스레드를 사용
    2. Dispatchers.Default (싱글톤) : CPU를 많이 쓰는 연산 작업을 위한 디스패처 (암호화, 패턴매칭, Json 직렬화/역직렬화, 파일 처리, 이미지 변환 처리, 수학적 계산 등)
        1. 대용량 데티어를 처리해야 하는 작업처럼 CPU 바운드 작업이 있는 경우 사용
        2. 특정연산이 무겁고 오래 걸리는 연산인 경우 모든 스레드가 사용될 수 있다. 이걸 방지하기 위해서는 limitedParallelism 함수를 사용한다.
        3. 입출력과 CPU 바운드 작업의 중요한 차이는 스레드 지속 사용여부. IO 같은 경우 결과가 나올때까지 보통 대기해서 지속적으로 쓰지 않지만, CPU 바운드 작업은 지속적으로 스레드 사용함.
        4. 입출력 작업은 스레드로 했을때보다 코루틴으로 했을 떄 빠르며, CPU 바운드 작업은 스레드, 코루틴 둘다 비슷하다.
    3. Dispatchers.Main : 메인 스레드를 사용하기 위한 CoroutineDispatcher
        1. android에서 UI에서 메인 스레드에서 쓸 때 사용한다고 함.
        2. 별도 lib (kotlinx-coroutines-android) 를 추가해야 사용 할 수 있다.
    4. 공유 스레드 풀
        1. 공유 스레드 풀 이름은 DefaultDispatcher-worker-숫자이며, IO / Default가 같은 스레드풀을 사용한다.'
        2. 그러나 IO / Default가 사용하는 스레드는 구분된다.
        3. limitedParallelism(n) : IO는 스레드를 새로 생성, Default는 스레드풀에 있는것에서 사용, 동작방식이 다름